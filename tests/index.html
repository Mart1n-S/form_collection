<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Bar with Subsections</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        .progress-container {
            display: grid;
            grid-auto-flow: column;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            align-items: center;
            position: relative;
            justify-items: center;
            margin: 20px auto;
            width: 80%;
        }

        .progress-bar-fix {
            position: absolute;
            top: 35%;
            height: 5px;
            background-color: #ccc;
            z-index: -2;
            transform: translateY(-50%);
        }

        .progress-item {
            display: flex;
            justify-content: center;
        }

        .progress-bar {
            position: absolute;
            top: 35%;
            left: 10%;
            height: 5px;
            background-color: #2e7d32;
            z-index: -1;
            transform: translateY(-50%);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #555;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            margin-bottom: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .step.active {
            background-color: #2e7d32;
        }

        .step.completed {
            background-color: #2e7d32;
        }

        .progress-item>div:last-child {
            font-size: 0.9rem;
            color: #333;
            margin-top: 5px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            margin: 20px 0;
            padding: 20px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .buttons {
            margin: 20px 0;
            text-align: center;
        }

        .buttons button {
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            background-color: #2e7d32;
            color: white;
            cursor: pointer;
        }

        .buttons button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>

</head>

<body>
    <div class="progress-container">
        <div class="progress-bar-fix"></div>
        <div class="progress-bar" id="progress-bar"></div>
        <div class="progress-item">
            <div class="step" data-stepper-step="1">1</div>
            <div>Nom</div>
        </div>
        <div class="progress-item">
            <div class="step" data-stepper-step="2">2</div>
            <div>Prénom</div>
        </div>
        <div class="progress-item">
            <div class="step" data-stepper-step="3">3</div>
            <div>Adresse</div>
        </div>
        <div class="progress-item">
            <div class="step" data-stepper-step="4">4</div>
            <div>Code Postal</div>
        </div>

        <div class="progress-item">
            <div class="step" data-stepper-step="5">5</div>
            <div>Ville</div>
        </div>
        <div class="progress-item">
            <div class="step" data-stepper-step="6">6</div>
            <div>Ville de naissance</div>
        </div>
        <div class="progress-item">
            <div class="step" data-stepper-step="7">7</div>
            <div>Ville de deces</div>
        </div>
        <div class="progress-item">
            <div class="step" data-stepper-step="8">8</div>
            <div>Ville de deces</div>
        </div>
        <div class="progress-item">
            <div class="step" data-stepper-step="9">9</div>
            <div>Ville de deces</div>
        </div>
        <div class="progress-item">
            <div class="step" data-stepper-step="10">10</div>
            <div>Ville de deces</div>
        </div>
    </div>

    <div id="sections">
        <section class="section active" data-step="1">Étape 1 - Sous-section 1</section>
        <section class="section" data-step="1">Étape 1 - Sous-section 2</section>
        <section class="section" data-step="1">Étape 1 - Sous-section 3</section>
        <section class="section" data-step="2">Étape 2 - Sous-section 1</section>
        <section class="section" data-step="3">Étape 3 - Sous-section 1</section>
        <section class="section" data-step="4">Étape 4 - Sous-section 1</section>
        <section class="section" data-step="4">Étape 4 - Sous-section 1</section>
        <section class="section" data-step="5">Étape 5 - Sous-section 1</section>
        <section class="section" data-step="5">Étape 5 - Sous-section 2</section>
        <section class="section" data-step="6">Étape 6 - Sous-section 1</section>
        <section class="section" data-step="7">Étape 7 - Sous-section 1</section>
    </div>

    <div class="buttons">
        <button id="prev-btn" disabled>Précédent</button>
        <button id="next-btn">Suivant</button>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            const $steps = $(".step");
            const $sections = $(".section");
            const $progressBarFix = $(".progress-bar-fix");
            const $progressBar = $("#progress-bar");
            const $prevBtn = $("#prev-btn");
            const $nextBtn = $("#next-btn");

            let currentSectionIndex = 0; // Index de la section actuelle
            const totalSections = $sections.length;

            // Ajuste dynamiquement la largeur et la position de la barre fixe
            function adjustProgressBarFix() {
                const totalSteps = $steps.length;
                const containerWidth = $(".progress-container").width();
                const stepSpacing = containerWidth / totalSteps;

                // Ajuste la largeur et la position de la barre fixe
                $progressBarFix.css({
                    width: `${(totalSteps - 1) * stepSpacing}px`,
                    left: `${stepSpacing / 2}px`,
                });

                $progressBar.css({
                    left: `${stepSpacing / 2}px`,
                });
            }

            // Appeler lors du redimensionnement de la fenêtre pour rester réactif
            $(window).resize(adjustProgressBarFix);

            // Initialisation
            adjustProgressBarFix();

            // Groupe les sections par étape
            const stepSections = [];
            $steps.each(function () {
                const stepNumber = $(this).data("stepper-step");
                const subSections = $sections.filter(`[data-step="${stepNumber}"]`);
                stepSections.push({
                    step: stepNumber,
                    subSectionsCount: subSections.length,
                });
            });

            const totalSteps = stepSections.length - 1;
            const stepWidth = 80 / totalSteps;

            // Fonction pour mettre à jour la barre de progression
            function updateProgressBar() {
                let progress = 0;
                let sectionsPassed = 0;

                $.each(stepSections, function (index, stepData) {
                    const subSectionWidth = stepWidth / stepData.subSectionsCount;
                    console.log("currentSectionIndex : " + currentSectionIndex, "sectionPassed : " + sectionsPassed, "countSubSection : " + stepData.subSectionsCount);
                    if (
                        currentSectionIndex >= sectionsPassed &&
                        currentSectionIndex < sectionsPassed + stepData.subSectionsCount
                    ) {
                        console.log('index : ' + index, 'stepWidth : ' + stepWidth, 'subSectionWidth : ' + subSectionWidth, 'sectionsPassed : ' + sectionsPassed, 'currentSectionIndex : ' + currentSectionIndex);
                        progress =
                            index * stepWidth +
                            (currentSectionIndex - sectionsPassed) * subSectionWidth;
                    }

                    sectionsPassed += stepData.subSectionsCount;
                });

                progress = Math.min(progress, 80);
                $progressBar.css("width", `${progress}%`);

                // Met à jour les étapes actives et terminées
                $steps.each(function (index) {
                    const $step = $(this);
                    const isActive =
                        currentSectionIndex >=
                        stepSections
                            .slice(0, index)
                            .reduce((a, b) => a + b.subSectionsCount, 0) &&
                        currentSectionIndex <
                        stepSections
                            .slice(0, index + 1)
                            .reduce((a, b) => a + b.subSectionsCount, 0);

                    $step.toggleClass("active", isActive);

                    if (
                        currentSectionIndex >=
                        stepSections
                            .slice(0, index + 1)
                            .reduce((a, b) => a + b.subSectionsCount, 0)
                    ) {
                        $step.addClass("completed").html('<span class="check">&#10003;</span>');
                    } else {
                        $step.removeClass("completed").text(index + 1);
                    }
                });
            }

            // Met à jour les sections visibles
            function updateSections() {
                $sections.each(function (index) {
                    $(this).toggleClass("active", index === currentSectionIndex);
                });
            }

            // Met à jour les boutons
            function updateButtons() {
                $prevBtn.prop("disabled", currentSectionIndex === 0);
                $nextBtn.prop("disabled", currentSectionIndex === totalSections - 1);
            }

            // Gestion des clics sur les boutons
            $nextBtn.on("click", function () {
                if (currentSectionIndex < totalSections - 1) {
                    currentSectionIndex++;
                    updateProgressBar();
                    updateSections();
                    updateButtons();
                }
            });

            $prevBtn.on("click", function () {
                if (currentSectionIndex > 0) {
                    currentSectionIndex--;
                    updateProgressBar();
                    updateSections();
                    updateButtons();
                }
            });

            // Initialisation
            updateProgressBar();
            updateSections();
            updateButtons();
        });
    </script>



</body>

</html>